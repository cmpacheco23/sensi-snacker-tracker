<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/eachprofile.css" />

<%- include('../partials/nav') %>


<main>
  <section class="header">
    <img class="profile-avatar" src="<%= profile.avatar %>" alt="<%= profile.name %>'s avatar">
    <h1> It's <%= isSelf ? "you" : profile.name %>!</h1>
    <% if (profile.foods.length) { %>
      <h2><%= isSelf ? 'You have' : `${profile.name} has` %> foods see them here!</h2>
      <h3><%= isSelf ? 'You have' : `${profile.name} has`%> been tracking your foods since <%=profile.createdAt.toLocaleDateString() %></h3>
    <% } else { %>
      <h2><%= isSelf ? "You don't" : `${profile.name} doesn't` %> have any foods added!</h2>
        <% } %>  
  </section>

      <!-- START OF FOREACH LOOP -->
  <section class="background-card-container">
    <% profile.foods.forEach(food=> { %>
      <article class="food-card">
        <div class="food-text-container">
          <h3 class="food-info" id="food-name"><a href="<%= food.name %>"><%= food.name %></a></h3>
          <p class="food-info" id="food-category"> <b>Category: </b><%= food.category %></p>
          <p class="food-info" id="food-vitamin"><b> Vitamins: </b><%= food.vitamins?.join(', ') %></p>
          <p class="food-info" id="food-reaction"><b>Reaction: </b> <%= food.reactions ? "Yes" : "No" %></p>
        </div>
      </article>
      
      <section class="buttons-background">
      <% if (profile._id.equals(user?.profile._id) && food.owner.equals(user?.profile._id) && profile.foods.some(eachFood => eachFood._id === food._id)) { %>
      <!-- <span>I AM LOGGED IN + THIS IS MY PROFILE + I OWN THIS FOOD + ITS IN MY ARRAY!</span> -->
      <!-- this code works -->
        <div class="buttons-container">
          <form action="/foods/<%= food._id %>/delete-from-profile?_method=DELETE" method="POST"> <button type="submit"> Delete | I own</button></form>
        </div>
      <% } %>


      <% if (profile._id.equals(user?.profile._id) && !food.owner.equals(user?.profile._id) && profile.foods.some(eachFood => eachFood._id === food._id)) { %>
        <!-- <span>I AM LOGGED IN + THIS IS MY PROFILE + I DO NOT OWN THIS FOOD + ITS IN MY ARRAY!</span> -->
        <div class="buttons-container">
          <form action="/foods/<%= food._id %>/delete-from-profile?_method=DELETE" method="POST">
            <button type="submit"> Delete | I don't own</button> </form>
        </div>

      <% } %>


      <% if (!profile._id.equals(user?.profile._id) && !food.owner.equals(user?.profile._id) && !profile.foods.some(eachFood => eachFood._id === food._id)) { %>
        <!-- <span> THIS IS NOT MY PROFILE + I DO NOT OWN THIS FOOD + ITS  NOT IN MY ARRAY!</span> -->
        <!-- this code does not work -->
        <div class="buttons-container">
          <form action="/foods/<%= food._id %>/delete-from-profile?_method=DELETE" method="POST">
            <button type="submit"> Delete From Profile</button>
          </form>
        </div>
      <% } %>
    </section>

  <% }) %>



          <!-- END OF IF STAMEMENT profile.foods.length -->



</main>

<%- include('../partials/footer') %>