<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<main>
  <div>
    <img class="profile-avatar" src="<%= profile.avatar %>" alt="<%= profile.name %>'s avatar">
  </div>
  <h1> It's <%= isSelf ? "you" : profile.name %>!</h1>
  <% if (profile.foods.length) { %>
    <h2> <%= isSelf ? 'You have' : `${profile.name} has` %> foods see them here! </h2>
    <h3>
      <%= isSelf ? 'You have' : `${profile.name} has`%>
      been tracking your foods since <%= profile.createdAt.toLocaleDateString() %>
    </h3>
    <% profile.foods.forEach(food => { %>
      <ul>
        <li> Food Name: <a href="<%= food.name %>">
        <%= food.name %> </a> </li>
        <li> Category: <%= food.category %></li>
        <li> Vitamin: <%= food.vitamins?.join(', ') %></li>
        <li> Reaction: <%= food.reactions ? "Yes" : "No" %></li>
      </ul>
      <% if (!food.owner.equals(user?.profile._id)) { %>
        <!-- if the logged in user isnt the owner of the food -->
        <!-- run check if food exists function -->
        <% if (profile.foods.some(eachFood => eachFood.equals(food._id))) { %>
          <!-- the logged in user doesn't own the food but the food exists in the foods array-->
            <!-- <h1>logged in user owns this food, nothing to do</h1> -->
            <h2>I DONT OWN THIS FOOD AND ITS IN MY ARRAY - i'm logged in</h2>
            <form action="/foods/<%= food._id %>/delete-from-profile?_method=DELETE" method="POST">
              <button type="submit"> Delete From Profile</button>
            </form> 
            <% if (food.owner.equals(user?.profile._id)) { %>
              <h2>I OWN THIS FOOD AND ITS IN MY ARRAY - i'm logged in</h2>
              <form action="/foods/<%= food._id %>/delete-from-profile?_method=DELETE" method="POST">
                <button type="submit"> Delete From Profile</button>
              </form> 
            <% } %>
            <% }%> 
        <% } %>
        <% if (food.owner.equals(user?.profile._id)) { %>
          <!-- if the logged in user IS the owner of the food -->
          <% if (profile.foods.some(eachFood => eachFood.equals(food._id))) { %>
            <h2>I OWN THIS FOOD, ITS IN MY ARRAY - i'm logged in</h2>
            <form action="/foods/<%= food._id %>/delete-from-profile?_method=DELETE" method="POST">
              <button type="submit"> Delete From Profile</button>
            </form> 
          <% } %>
        <% } %>
        <% }) %>


    <% } else { %>
    <h2><%= isSelf ? "You don't" : `${profile.name} doesn't` %> have any foods added!</h2>
  <% } %>
</main>

<%- include('../partials/footer') %>