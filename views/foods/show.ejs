<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/foodeach.css" />
<%- include('../partials/nav') %>

<main class="layout">
<section class="header">
  <h1 class="food-h1s"><%= food.name %> <%= title %></h1>
  <% if (food.owner.equals(user?.profile._id)) { %>
    <div class="form-divs-btns" id="edit-btn">
      <a href="/foods/<%= food._id %>/edit">
        <button type="submit" class="btn"> Edit Details</button>
      </a>
    </div>
  <% } %>
</section>

<section class="food-details">
  <form action="/foods/<%= food._id %>" method="GET">
    <div class="info">
      <label>Category: </label>
      <%= food.category %>
    </div>
    <div class="info">
      <label>Vitamins: </label>
      <%= food.vitamins %>
    </div>
  </form>
</section>


<section class="add-items">

  <h4 class="food-h4"> Want to add a vitamin to <%= food.name %>?</h4>

    <select name="vitamins" id="vitamins-select">
      <% food.vitamins.forEach(vitamin => { %>
        <option value="<%= vitamin %>"> <%= vitamin %></option>
      <% }) %>
    </select>
    <div class="form-divs-btns">
      <button type="submit" class="btn">Add Vitamin</button>
    </div>
</section>

<section class="add-reaction">
  <h2>Experience</h2>
<% if (user) { %>
  <p>Add your experience such as symptoms or reactions</p>
  <form action="/foods/<%= food._id %>/reactions" method="POST">
    <div class="input-labels">
      <label for="allergen-input">Potential Allergen: </label>
      <input type="text" name="potentialAllergen" id="allergen-input" class="inputbottom">
      <label for="condition-input">Potential Condition: </label>
      <input type="text" name="potentialCondition" id="condition-input" class="inputbottom">
    </div>
    <label for="name-textarea">Reaction:</label>
    <textarea name="text" id="name-textarea" cols="40" rows="6" class="form-input-text"></textarea>
    <div class="button-holder">
      <button type="submit" class="btn" id="add-reaction">Add Experience</button>
    </div>
  </form>
<% } %>
</section>
<section class="reactions-listed">
  <h2></h2>
  <% if (food.reactions.length) { %>
    <table>
      <thead>
        <tr>
          <th> </th>
          <th> Added By</th>
          <th> Created On</th>
          <th> Experience / Reaction </th>
          <th> Potential Allergen</th>
          <th> Potential Condition</th>
        </tr>
      </thead>
      <% food.reactions.forEach(reaction => { %>
        <tbody>
          <tr>
            <% if (food.owner.equals(user?.profile._id)) { %>
              <td> <form action="/foods/<%= food._id %>/reactions/<%= reaction._id %>?_method=DELETE" method="POST">
                <button type="submit">x</button>
              </form>
            </td>
            <% } %>
            <td> <%= reaction.owner.name %></td>
            <td> <%= reaction.createdAt.toLocaleDateString() %></td>
            <td> <%= reaction.text %></td>
            <td> <%= reaction.potentialAllergen %></td>
            <td> <%= reaction.potentialCondition %></td>
          </tr>
        </tbody>
      <% }) %>
    </table>
  <% } %>
</section>
</main>
<%- include('../partials/footer') %>